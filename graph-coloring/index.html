<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colora il grafo</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    /* Mini stile per il toggler lingua (non invasivo) */
    .lang-switch{ margin-left:auto; display:inline-flex; gap:8px; }
    .lang-switch button{
      padding:6px 10px; border-radius:8px; border:1px solid #334; background:#111; color:#fff; cursor:pointer;
    }
    .lang-switch button[aria-pressed="true"]{ background:#222; font-weight:700; }
    @media (prefers-color-scheme: light){
      .lang-switch button{ background:#f3f4f6; color:#111; border-color:#d1d5db; }
      .lang-switch button[aria-pressed="true"]{ background:#e5e7eb; }
    }
  </style>
</head>
<body>
  <!-- Sfondo -->
  <div class="stars"></div><div class="stars2"></div>

  <!-- Titolo -->
  <h1 data-i18n="title">Colora il grafo</h1>
  <div class="sub" data-i18n="subtitle">Assegna colori ai nodi minimizzando il numero di colori ed evitando conflitti tra nodi adiacenti.</div>

  <!-- Barra comandi -->
  <div class="topbar" role="toolbar" aria-label="Barra di controllo">
    <label for="levelSel" data-i18n="level_label">Livello</label>
    <select id="levelSel" name="level" aria-label="Seleziona livello"></select>
    <button id="loadBtn" type="button" data-i18n="btn_load">Carica</button>
    <button id="resetBtn" type="button" data-i18n="btn_reset">Reset</button>

    <div class="pill" aria-live="polite">
      <span class="chip"><span data-i18n="used_label">Colori usati:</span> <b id="used">–</b></span>
      <span class="chip"><span data-i18n="conf_label">Conflitti:</span> <b id="conf">–</b></span>
      <span class="chip"><span data-i18n="goal_label">Obiettivo: ≤</span> <b id="goal">–</b></span>
    </div>

    <!-- Toggle lingua -->
    <div class="lang-switch" aria-label="Lingua / Language">
      <button id="btn-it" type="button" aria-pressed="true">IT</button>
      <button id="btn-en" type="button" aria-pressed="false">EN</button>
    </div>
  </div>

  <!-- Griglia 3 colonne -->
  <div class="wrap">
    <!-- SINISTRA -->
    <aside class="card" aria-label="Informazioni e istruzioni">
      <h3 data-i18n="h_problem">Il problema della colorazione di un grafo</h3>
      <p class="muted" data-i18n="p_problem_1">
        Vogliamo dare un <b>colore</b> a ogni nodo in modo che <b>due nodi collegati non abbiano lo stesso colore</b>,
        usando <b>il minor numero di colori</b>. In pratica significa assegnare <b>risorse diverse a elementi che si
        interferiscono</b>: ad esempio scegliere <i>canali Wi-Fi</i> diversi per router vicini, mettere <i>lezioni</i>
        che condividono aula/docente in <i>orari diversi</i>, o colorare le <i>regioni di una mappa</i> con pochi
        pennarelli senza che due confinanti abbiano lo stesso colore. Meno colori ⇒ uso più efficiente delle risorse.
      </p>
      <p class="muted" data-i18n="p_problem_2">
        Trovare il numero minimo di colori è un problema <b>NP-difficile</b>. Nella pratica si usano
        <b>euristiche</b> (rapide, non garantiscono l’ottimo) e, su grafi piccoli, <b>algoritmi esatti</b>
        (ottimi ma più lenti).
      </p>

      <h3 data-i18n="h_howto">Istruzioni di gioco</h3>
      <ol class="muted">
        <li data-i18n="howto_1">Seleziona un livello e premi <b>Carica</b>.</li>
        <li data-i18n="howto_2">Clicca un nodo per assegnare il colore selezionato nella tavolozza.</li>
        <li data-i18n="howto_3"><b>Shift + Click</b> rimuove il colore dal nodo.</li>
        <li id="winCond">Vince chi ottiene <b>0 conflitti</b> usando ≤ <b id="goal2">–</b> colori.</li>
      </ol>

      <h3 data-i18n="h_palette">Tavolozza</h3>
      <div id="palette" class="palette" aria-label="Tavolozza colori"></div>
      <div class="muted" data-i18n="tip_deg">Suggerimento: inizia dai nodi con più vicini.</div>
    </aside>

    <!-- CENTRO -->
    <main class="card" aria-label="Area di gioco">
      <canvas id="stage" aria-label="Canvas grafo"></canvas>
    </main>

    <!-- DESTRA -->
    <aside class="card" aria-label="Algoritmi">
      <h3 data-i18n="h_alg">Algoritmi</h3>

      <div class="btn-sub" data-i18n="heur_hint">Euristico (veloce, non garantisce l’ottimo)</div>
      <button id="btnDSATUR" class="btn-block" type="button" data-i18n="btn_dsatur">Auto (DSATUR)</button>
      <div id="infoDSATUR" class="algo-info"></div>

      <h3 data-i18n="h_exact">Esatto</h3>
      <div class="btn-sub" data-i18n="exact_hint">Garantisce il minimo, solo per grafi piccoli (≤ 15 nodi)</div>
      <button id="btnBacktrack" class="btn-block" type="button" data-i18n="btn_backtrack">Backtracking</button>
      <div id="infoBacktrack" class="algo-info"></div>

      <p class="muted" style="margin-top:8px;" id="levelGoalP">Obiettivo livello: ≤ <b id="goal2_mirror">–</b> colori e 0 conflitti.</p>

      <hr class="hint-sep" />
      <button id="btnHint" class="btn-block" type="button" data-i18n="btn_hint">Suggerimento: nodo critico</button>
    </aside>
  </div>

  <footer class="footer">Carolina Crespi ©</footer>

  <!-- i18n -->
  <script>
    const i18n = {
      it: {
        page_title: "Colora il grafo",
        title: "Colora il grafo",
        subtitle: "Assegna colori ai nodi minimizzando il numero di colori ed evitando conflitti tra nodi adiacenti.",
        level_label: "Livello",
        btn_load: "Carica",
        btn_reset: "Reset",
        used_label: "Colori usati:",
        conf_label: "Conflitti:",
        goal_label: "Obiettivo: ≤",
        toolbar_aria: "Barra di controllo",
        level_aria: "Seleziona livello",
        left_aria: "Informazioni e istruzioni",
        main_aria: "Area di gioco",
        right_aria: "Algoritmi",
        canvas_aria: "Canvas grafo",

        h_problem: "Il problema della colorazione di un grafo",
        p_problem_1: "Vogliamo dare un <b>colore</b> a ogni nodo in modo che <b>due nodi collegati non abbiano lo stesso colore</b>, usando <b>il minor numero di colori</b>. In pratica significa assegnare <b>risorse diverse a elementi che si interferiscono</b>: ad esempio scegliere <i>canali Wi-Fi</i> diversi per router vicini, mettere <i>lezioni</i> che condividono aula/docente in <i>orari diversi</i>, o colorare le <i>regioni di una mappa</i> con pochi pennarelli senza che due confinanti abbiano lo stesso colore. Meno colori ⇒ uso più efficiente delle risorse.",
        p_problem_2: "Trovare il numero minimo di colori è un problema <b>NP-difficile</b>. Nella pratica si usano <b>euristiche</b> (rapide, non garantiscono l’ottimo) e, su grafi piccoli, <b>algoritmi esatti</b> (ottimi ma più lenti).",

        h_howto: "Istruzioni di gioco",
        howto_1: "Seleziona un livello e premi <b>Carica</b>.",
        howto_2: "Clicca un nodo per assegnare il colore selezionato nella tavolozza.",
        howto_3: "<b>Shift + Click</b> rimuove il colore dal nodo.",
        win_cond_tpl: "Vince chi ottiene <b>0 conflitti</b> usando ≤ {GOAL} colori.",

        h_palette: "Tavolozza",
        tip_deg: "Suggerimento: inizia dai nodi con più vicini.",

        h_alg: "Algoritmi",
        heur_hint: "Euristico (veloce, non garantisce l’ottimo)",
        btn_dsatur: "Auto (DSATUR)",
        h_exact: "Esatto",
        exact_hint: "Garantisce il minimo, solo per grafi piccoli (≤ 15 nodi)",
        btn_backtrack: "Backtracking",
        level_goal_tpl: "Obiettivo livello: ≤ {GOALM} colori e 0 conflitti.",
        btn_hint: "Suggerimento: nodo critico"
      },
      en: {
        page_title: "Graph Coloring",
        title: "Graph Coloring",
        subtitle: "Assign colors to nodes while minimizing the number of colors and avoiding conflicts between adjacent nodes.",
        level_label: "Level",
        btn_load: "Load",
        btn_reset: "Reset",
        used_label: "Colors used:",
        conf_label: "Conflicts:",
        goal_label: "Target: ≤",
        toolbar_aria: "Toolbar",
        level_aria: "Select level",
        left_aria: "Information & instructions",
        main_aria: "Play area",
        right_aria: "Algorithms",
        canvas_aria: "Graph canvas",

        h_problem: "The graph coloring problem",
        p_problem_1: "Assign a <b>color</b> to each node so that <b>adjacent nodes never share the same color</b>, using <b>as few colors as possible</b>. This models allocating <b>different resources to interfering elements</b>: e.g., different <i>Wi-Fi channels</i> for nearby routers, scheduling <i>lectures</i> that share room/teacher at <i>different times</i>, or coloring <i>map regions</i> with a few markers so that neighbors differ. Fewer colors ⇒ more efficient resource use.",
        p_problem_2: "Finding the minimum number of colors is <b>NP-hard</b>. In practice we use <b>heuristics</b> (fast, not guaranteed optimal) and, on small graphs, <b>exact algorithms</b> (optimal but slower).",

        h_howto: "How to play",
        howto_1: "Select a level and press <b>Load</b>.",
        howto_2: "Click a node to assign the selected color from the palette.",
        howto_3: "<b>Shift + Click</b> removes the color from the node.",
        win_cond_tpl: "Win by reaching <b>0 conflicts</b> using ≤ {GOAL} colors.",

        h_palette: "Palette",
        tip_deg: "Tip: start from the highest-degree nodes.",

        h_alg: "Algorithms",
        heur_hint: "Heuristic (fast, not guaranteed optimal)",
        btn_dsatur: "Auto (DSATUR)",
        h_exact: "Exact",
        exact_hint: "Guarantees the minimum; only for small graphs (≤ 15 nodes)",
        btn_backtrack: "Backtracking",
        level_goal_tpl: "Level goal: ≤ {GOALM} colors and 0 conflicts.",
        btn_hint: "Hint: critical node"
      }
    };

    const $ = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>[...r.querySelectorAll(s)];

    function setLang(lang){
      const d = i18n[lang] || i18n.it;

      // Testi semplici
      $$('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if(d[key]) el.innerHTML = d[key];
      });

      // Titolo pagina
      document.title = d.page_title || document.title;

      // ARIA label
      $('.topbar')?.setAttribute('aria-label', d.toolbar_aria);
      $('#levelSel')?.setAttribute('aria-label', d.level_aria);
      $$('aside.card')[0]?.setAttribute('aria-label', d.left_aria);
      $$('aside.card')[1]?.setAttribute('aria-label', d.right_aria);
      $('main.card')?.setAttribute('aria-label', d.main_aria);
      $('#stage')?.setAttribute('aria-label', d.canvas_aria);

      // Frasi con numeri dinamici (mantieni i valori correnti)
      const goal2 = $('#goal2');
      if (goal2) {
        const gVal = goal2.textContent || '–';
        const win = d.win_cond_tpl.replace('{GOAL}', `<b id="goal2">${gVal}</b>`);
        $('#winCond').innerHTML = win;
      }

      const goal2m = $('#goal2_mirror');
      if (goal2m) {
        const gmVal = goal2m.textContent || '–';
        const goalLine = d.level_goal_tpl.replace('{GOALM}', `<b id="goal2_mirror">${gmVal}</b>`);
        $('#levelGoalP').innerHTML = goalLine;
      }

      // Stato pulsanti lingua
      $('#btn-it')?.setAttribute('aria-pressed', lang==='it');
      $('#btn-en')?.setAttribute('aria-pressed', lang==='en');
      document.documentElement.lang = lang;
      localStorage.setItem('gc_lang', lang);
    }

    // Bind
    $('#btn-it')?.addEventListener('click', ()=>setLang('it'));
    $('#btn-en')?.addEventListener('click', ()=>setLang('en'));

    // Init da storage o lingua browser
    const saved = localStorage.getItem('gc_lang');
    const browser = (navigator.language||'it').toLowerCase().startsWith('en')? 'en':'it';
    setLang(saved || browser);
  </script>

  <!-- la tua logica rimane invariata -->
  <script type="module" src="./app.js"></script>
</body>
</html>
